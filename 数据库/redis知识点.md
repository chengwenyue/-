# redis

## redis 面试题

收集的面试题

Redis 持久化机制
缓存雪崩、缓存穿透、缓存预热、缓存更新、缓存降级等问题
热点数据和冷数据是什么
Memcache与Redis的区别都有哪些？
单线程的redis为什么这么快
redis的数据类型，以及每种数据类型的使用场景，Redis 内部结构
redis的过期策略以及内存淘汰机制【～】
Redis 为什么是单线程的，优点
如何解决redis的并发竞争key问题
Redis 集群方案应该怎么做？都有哪些方案？
有没有尝试进行多机redis 的部署？如何保证数据一致的？
对于大量的请求怎么样处理
Redis 常见性能问题和解决方案？
讲解下Redis线程模型
为什么Redis的操作是原子性的，怎么保证原子性的？
Redis事务
Redis实现分布式锁
Redis内存抖动



### 1. Redis实现分布式锁

名词概念：

1. 资源key：锁定的key，也可以认为就是这把锁
2. 租期：锁的租期，超过租期时间后锁自动释放。如果没有租期，进程在获取锁后宕机而没有手动释放锁，那么其他进程永远都获取不到这把锁。
3. 锁的看门狗：在锁的租期内不断延长锁的租期时间，防止锁被自动释放。

加锁过程：

1. 判断是否存在key，如果存在，加锁失败，返回key的剩余租期时间，并阻塞等待。
2. 在redis中添加一个资源key，value值为当前线程的标识，并设置租期。（使用lua脚本，保证原子性）
3. 启动看门狗任务，延长锁的租期。

释放锁的过程：

1. 判断是否存在key，如果存在，判断value值是否等于当前线程标识。
2. 如果等于，则删除key，如果不等于说明锁已经被其他线程获取，不能删除。



存在的问题：

1. 锁的重入问题

 	2. 等待锁的进程如何设置等待时长和锁的通知

>  http://redis.cn/topics/distlock.html



### 2.redis持久化机制

rdb持久化，持久化时会fork一个子进程，子进程拥有和主进程一样的内存数据，然后持久化到文件中。

触发时机

1. 手动触发，使用bgsave，save命令
2. redis配置中save配置，save 60 10000 ，表示60秒内有有10000次更新操作就执行持久化操作。
3. shutdown时，如果没设置aof，那么也会持久化一次。



aof持久化，将客户端的更新操作以命令的形式追加在aof文件的中。

触发时机，由配置文件appendfsync的值决定

	1. no，由操作系统决定何时将数据持久化到文件中（快，不能保证持久化）
 	2. always，每次发生更新时都持久化到文件中，（慢，安全）
 	3. everysec，一秒同步一次，默认值，可能会丢失一秒内的数据。

aof重写机制，当aof文件增长到一定值时会触发aof重写机制，能减少aof文件大小。是一种异步的方式重写。

混合持久化，4.0之后才有的，触发形式同aof重写一直，不同的是最终得到的文件的前半段是rdb的形式，后半段是aof的形式。

优点：加载恢复速度快，数据丢失少，缺点：兼容性查